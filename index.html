<!DOCTYPE html>
<html>
<head>
    <title>Yafet Lottery</title>
    <link rel="stylesheet" href="style.css">
    <style>
    /* Winners banner styles */
    .winners-banner { display:flex; gap:14px; justify-content:center; align-items:center; margin:14px 0 18px; }
    /* single centered winner display ‚Äî cycles texts one by one */
    /* Updated: yellow background, darker text, italic label */
    .winner-item { width:100%; max-width:720px; background: linear-gradient(180deg, #FFF59D, #FFD700); border-radius:12px; padding:12px 20px; color:#222; position:relative; overflow:hidden; display:flex; align-items:center; justify-content:center; box-shadow: 0 8px 18px rgba(0,0,0,0.12); border:1px solid rgba(0,0,0,0.08); height:64px; }
    .winner-item .label { color:#222; font-weight:800; font-size:20px; text-align:center; display:inline-block; font-style:italic; }
    .winner-item::before { content:''; position:absolute; inset:0; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240'><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='100' fill='%23333333'>üèÜ</text></svg>"); background-repeat:no-repeat; background-position:calc(100% - 48px) calc(100% - 28px); opacity:0.04; pointer-events:none; }
    /* trophy icon */
    .winner-item .trophy { position:absolute; left:14px; top:50%; transform:translateY(-50%); font-size:28px; opacity:0.96; filter:drop-shadow(0 6px 8px rgba(0,0,0,0.12)); animation:float 3s ease-in-out infinite; }
    @keyframes float { 0% { transform: translateY(-50%) translateY(0); } 50% { transform: translateY(-50%) translateY(-6px); } 100% { transform: translateY(-50%) translateY(0); } }
    /* inner content wrapper to animate slide in/out without shifting layout */
    .winner-inner { display:flex; align-items:center; justify-content:center; width:100%; height:100%; transform:translateY(0); transition: transform 420ms cubic-bezier(.2,.9,.2,1), opacity 320ms ease; padding-left:48px; box-sizing:border-box; }
    .winner-inner.slide-out { transform: translateY(-40%); opacity:0; }
    .winner-inner.slide-in { transform: translateY(0); opacity:1; }
    /* typing caret */
    .typing { white-space:nowrap; overflow:hidden; }
    .typing.caret::after { content:'|'; margin-left:6px; display:inline-block; animation:blink 1s steps(1) infinite; color:#222; }
    @keyframes blink { 50% { opacity:0; } }
    @media (max-width:760px) { .winners-banner { flex-direction:column; } }
    </style>
</head>
<body>

<div class="bg-lights">
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="light"></span>
    <span class="moving-object"></span>
</div>

<div class="card">
    <h1>üé´ Play Lottery</h1>

    <!-- Winners banner -->
    <div class="winners-banner">
            <div class="winner-item">
                <div class="trophy">üèÜ</div>
                <div class="winner-inner">
                    <div class="label typing" id="wDisplay"> </div>
                </div>
            </div>
    </div>

    <div class="section-title">Current Lottery</div>
    <p id="roundName">Loading...</p>
    <p id="ticketPrice"></p>
    <p id="statusText"></p>
    <!-- Countdown display and Live button -->
    <div style="margin-top:12px;text-align:center;">
        <div id="countdownTimer" style="font-weight:700;font-size:16px;color:#00ff66;margin-bottom:8px;">--:--:--</div>
        <button id="liveBtn" style="max-width:200px;margin:0 auto;">Go Live</button>
    </div>

    <hr>

    <div class="section-title">Buy Ticket</div>
    <div class="input-group">
    <input id="username" placeholder=" " required>
        <label for="username">Your Name</label>
    </div>
        <!-- Phone number input -->
        <div class="input-group">
            <input id="phone" type="tel" pattern="[0-9]{10}" maxlength="10" placeholder=" " required oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,10)">
            <label for="phone">Phone Number</label>
        </div>
    <div class="input-group">
    <input id="number" type="number" min="1" max="100" step="1" pattern="^(?:[1-9]|[1-9][0-9]|[1-4][0-9]{2}|100)$" placeholder=" " required oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,3); if(this.value){ const n=Number(this.value); if(n>100) this.value='100'; else if(n<1) this.value='1'; }">
        <label for="number">Pick a ticket number (1-100)</label>
    <div style="height:18px;"></div>
    </div>

    <!-- Payment instructions and file input -->
    <div style="margin-bottom:8px;">
        <div style="color:#00ffcc;font-size:15px;margin-bottom:4px;"><b>Telebirr:</b> 0974477230 <br>Yafet Tilahun</div>
        <div style="color:#ffd700;font-size:15px;"><b>CBE:</b> 1000528475977 <br> Deksiyos Yismaw</div>
        <div style="color:#aaa;font-size:13px;margin-top:4px;">Send payment to one of the above numbers, then select the payment method and then screenshot the trasaction then upload your payment transaction proof below.</div>
    </div>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:18px;">
        <span style="font-size:15px;color:#00ff66;white-space:nowrap;">Payment Method</span>
        <select id="paymentMethod" style="width:140px;min-width:100px;max-width:180px;padding:8px 10px;font-size:15px;border-radius:8px;border:1.5px solid #00ff6633;background:#101010;color:#00ffcc;outline:none;box-shadow:inset 0 0 10px rgba(0,255,102,0.07);transition:border-color 0.2s,box-shadow 0.2s;appearance:none;cursor:pointer;">
            <option value="telebirr">Telebirr</option>
            <option value="cbe">CBE</option>
        </select>
        <!-- Make select required for HTML5 validation -->
        <script>document.getElementById('paymentMethod').setAttribute('required', 'required');</script>
        </select>
    </div>
    <div class="input-group">
        <label for="paymentFile" style="top:0;left:0;transform:none;position:static;background:transparent;font-size:15px;color:#00ff66;display:block;margin-bottom:8px;">Payment Proof (screenshot/receipt)</label>
        <input id="paymentFile" type="file" accept="image/*,application/pdf" style="margin-top:6px;" required>
        <div id="paymentPreviewWrap" style="margin-top:10px;display:none;">
            <img id="paymentPreview" style="max-width:100%;max-height:120px;border-radius:8px;box-shadow:0 2px 8px #ffd70055;display:block;margin:0 auto;" />
        </div>
    </div>
    <button onclick="buyTicket()">Buy Ticket</button>
    <p id="buyMessage"></p>

    <hr>

    <div class="section-title">Results</div>
    <p id="winningNum">Not announced yet</p>

    

    <div class="section-title">History</div>
    <button onclick="loadHistory()">Show My Tickets</button>
    <pre id="historyList"></pre>

</div>


<script type="module" src="user.js"></script>
<script>
// Show preview for payment proof image
const paymentFileInput = document.getElementById('paymentFile');
const paymentPreview = document.getElementById('paymentPreview');
const paymentPreviewWrap = document.getElementById('paymentPreviewWrap');
if (paymentFileInput && paymentPreview && paymentPreviewWrap) {
    paymentFileInput.addEventListener('change', function() {
        const file = paymentFileInput.files && paymentFileInput.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                paymentPreview.src = e.target.result;
                paymentPreviewWrap.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            paymentPreviewWrap.style.display = 'none';
            paymentPreview.src = '';
        }
    });
}
</script>
<script>
// Typing animation for winners banner ‚Äî continuous loop: type, show time, delete, repeat
const winners = [
    { text: 'The First winner is 1000birr' },
    { text: 'The Second winner is 300birr' },
    { text: 'The Third winner is 100birr' }
];

function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

async function typeChars(el, text, speed=40){
    if (!el) return;
    el.classList.add('caret');
    el.textContent = '';
    for (let i=0;i<text.length;i++){
        el.textContent += text.charAt(i);
        await sleep(speed);
    }
    el.classList.remove('caret');
}

async function deleteChars(el, speed=30){
    if (!el) return;
    el.classList.add('caret');
    while (el.textContent.length>0){
        el.textContent = el.textContent.slice(0, -1);
        await sleep(speed);
    }
    el.classList.remove('caret');
}

(async function loopWinners(){
    const displayEl = document.getElementById('wDisplay');
    const inner = document.querySelector('.winner-inner');
    if (!displayEl || !inner) return;
    let idx = 0;
    while (true) {
        const txt = winners[idx].text;
        // slide old content up and hide
        inner.classList.add('slide-out');
        await sleep(420);
        // prepare inner to come from bottom
        inner.classList.remove('slide-out');
        inner.style.transition = 'none';
        inner.style.transform = 'translateY(40%)';
        inner.style.opacity = '0';
        displayEl.textContent = '';
        // force reflow then animate in
        requestAnimationFrame(() => {
            inner.style.transition = '';
            inner.style.transform = 'translateY(0)';
            inner.style.opacity = '1';
        });
        // type while sliding in
        await typeChars(displayEl, txt, 36);
        await sleep(1400);
        // slide out current text
        inner.classList.add('slide-out');
        await sleep(380);
        inner.classList.remove('slide-out');
        await sleep(200);
        idx = (idx + 1) % winners.length;
    }
})();
</script>
</body>
</html>
